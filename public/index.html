  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Call App</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">
  <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-center mb-6 px-4">
    Video Call App Developed by Adarsh Usha Singh
  </h1>
  
  <!-- Video Containers -->
  <div class="flex flex-wrap justify-center gap-6 mb-6 w-full max-w-4xl px-4">
    <div class="flex flex-col items-center">
      <video id="localVideo" autoplay muted class="w-40 h-32 md:w-64 md:h-48 bg-gray-800 rounded-lg"></video>
      <p class="text-center mt-2 text-sm md:text-base">You</p>
    </div>
    <div class="flex flex-col items-center">
      <video id="remoteVideo" autoplay class="w-40 h-32 md:w-64 md:h-48 bg-gray-800 rounded-lg"></video>
      <p class="text-center mt-2 text-sm md:text-base">Partner</p>
    </div>
  </div>

  <!-- Input and Buttons -->
  <div class="flex flex-wrap justify-center items-center gap-4 w-full px-4">
    <input
      type="number"
      id="peerIdInput"
      placeholder="Enter Partner's ID (4 digits)"
      class="p-2 w-64 md:w-80 rounded-lg bg-gray-700 text-white focus:ring focus:ring-blue-500 focus:outline-none"
      min="1000"
      max="9999"
    />
    <button
      id="callButton"
      class="p-2 w-20 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring focus:ring-blue-500 focus:outline-none"
    >
      Call
    </button>
  </div>
  
  <!-- Display Your ID -->
  <p class="mt-4 text-center px-4 text-sm md:text-base">
    Your ID: <span id="myPeerId" class="font-bold text-blue-400"></span>
  </p>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script>
    // Generate 4-digit numeric ID (1000-9999)
    const generateNumericId = () => Math.floor(1000 + Math.random() * 9000).toString();

    // Initialize PeerJS with numeric ID
    const peer = new Peer(generateNumericId(), {
      debug: 0,
      config: { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] }
    });

    // DOM Elements
    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const myPeerId = document.getElementById('myPeerId');
    const peerIdInput = document.getElementById('peerIdInput');
    const callButton = document.getElementById('callButton');

    // Display generated ID
    peer.on('open', (id) => {
      myPeerId.textContent = id;
      peerIdInput.placeholder = `Enter Partner's ID (${id.length}-digit)`;
    });

    // Error handling
    peer.on('error', (err) => {
      console.error('PeerJS Error:', err);
      alert(`Error: ${err.type} - ${err.message}`);
    });

    // Media handling
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then((stream) => {
        localVideo.srcObject = stream;

        // Call handler
        callButton.addEventListener('click', () => {
          const partnerId = peerIdInput.value.trim();
          if (partnerId && partnerId.length === 4) {
            const call = peer.call(partnerId, stream);
            call.on('stream', (remoteStream) => {
              remoteVideo.srcObject = remoteStream;
            });
          }
        });

        // Answer calls
        peer.on('call', (call) => {
          call.answer(stream);
          call.on('stream', (remoteStream) => {
            remoteVideo.srcObject = remoteStream;
          });
        });
      })
      .catch((error) => {
        console.error('Media Error:', error);
        alert('Camera/microphone access required!');
      });

    // Input validation
    peerIdInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.slice(0, 4);
    });
  </script>
</body>
</html>
